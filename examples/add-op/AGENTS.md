# Add 算子库 项目概况

## 开发命令 (Development Commands)

### 基本命令
- **安装依赖**: 项目依赖 CMake 3.10+ 和 C++11 兼容编译器，使用系统包管理器安装
- **查看文档**: 查看 README.md 获取快速开始指南，查看 docs/ 目录获取详细文档

### 工具命令
- **CMake 构建系统**: 使用 CMake 生成跨平台构建系统，支持 Linux、macOS 和 Windows
- **静态库生成**: 通过 `make` 命令编译生成 libfunc-add.a 静态库文件
- **单元测试框架**: 使用 CTest 进行自动化测试，确保代码质量和功能正确性

### 测试和验证命令
- **运行所有测试**: `cd build && ctest` 运行所有单元测试并输出结果
- **单独测试整数加法**: `cd build && ./test_addi` 运行整数加法功能测试
- **单独测试浮点数加法**: `cd build && ./test_addf` 运行浮点数加法功能测试

### 项目管理命令
- **清理构建文件**: `rm -rf build` 删除构建目录，清理所有编译产物
- **重新构建项目**: `mkdir build && cd build && cmake .. && make` 完整重新构建流程
- **安装库文件**: `cd build && make install` 将库文件安装到系统目录（需要管理员权限）

## 项目概述 (Project Overview)

### 核心目标
- **高性能数学运算库**: 提供轻量级、高性能的 C++ 数学运算库，专注于加法运算的优化实现
- **统一API接口**: 设计统一的模板化 API `unified_add`，支持多种数据类型的加法运算，提供类型安全的调用方式
- **跨平台兼容性**: 使用 CMake 构建系统确保项目在 Linux、macOS 和 Windows 平台上的兼容性和可移植性
- **完整的测试覆盖**: 为所有核心功能提供完整的单元测试，确保代码质量和功能正确性

### 开发模式
项目采用现代 C++ 开发模式，通过分层架构实现功能模块化。开发流程包括：需求分析 → 接口设计 → 底层实现 → API 封装 → 单元测试 → 集成测试 → 文档编写。使用 CMake 作为构建系统，支持自动化构建、测试和部署。代码遵循 C++11 标准，确保良好的兼容性和性能。

### 核心机制
- **模板特化机制**: 使用 C++ 模板特化技术实现 `unified_add` 统一接口，根据输入数据类型自动选择对应的底层实现
- **静态库封装**: 将核心算法封装为静态库，提供清晰的头文件接口，便于集成到其他项目中
- **分层架构设计**: 采用分层架构，底层实现具体算法（addi、addf），上层提供统一 API，确保代码的可维护性和扩展性
- **自动化测试框架**: 集成 CTest 测试框架，支持自动化测试和持续集成，确保代码质量和稳定性

## 技术架构 (Architecture Overview)

### 技术选型
- **C++11 标准**: 选择 C++11 作为开发语言标准，提供良好的性能和现代语言特性支持
- **CMake 构建系统**: 使用 CMake 3.10+ 作为构建工具，提供跨平台构建能力和依赖管理
- **静态库架构**: 采用静态库形式发布，便于集成到各种 C++ 项目中，无需运行时依赖
- **CTest 测试框架**: 使用 CTest 作为单元测试框架，提供自动化测试和持续集成支持

### 目录结构与组件
```
examples/add-op/
├── include/                 # 公共头文件目录
│   ├── add.h               # 原始加法接口头文件
│   ├── unified_api.h       # 统一API接口头文件
│   └── export/             # 导出接口目录
│       └── api.h           # 导出API头文件
├── src/                    # 源代码实现目录
│   ├── addi.cpp            # 整数加法实现
│   ├── addf.cpp            # 浮点数加法实现
│   └── unified_api.cpp     # 统一API实现
├── tests/                  # 单元测试文件目录
│   ├── test_addi.cpp       # 整数加法单元测试
│   └── test_addf.cpp       # 浮点数加法单元测试
├── docs/                   # 项目文档目录
│   ├── architecture.md     # 架构设计文档
│   ├── prd.md              # 产品需求文档
│   └── deviations.md       # 偏差说明文档
├── afunc/                  # afunc 相关配置和模板
│   ├── afuncs/            # afunc 功能定义
│   ├── tasks/              # 任务定义
│   └── templates/          # 模板文件
├── build/                  # 构建输出目录
├── CMakeLists.txt          # CMake 构建配置
├── Makefile               # Make 构建文件（兼容性支持）
├── README.md              # 项目说明文档
└── CHANGELOG.md           # 版本变更记录
```

### 组件详细说明
- **`include/add.h`**: 定义原始加法函数接口，包括 `addi`（整数加法）和 `addf`（浮点数加法）的函数声明
- **`include/unified_api.h`**: 定义统一模板化 API `unified_add`，使用模板特化技术提供类型安全的加法运算接口
- **`include/export/api.h`**: 导出 API 接口，提供 `fa_addi` 和 `fa_addf` 函数，作为库的外部接口
- **`src/addi.cpp`**: 实现 32 位整数加法功能，提供高效的整数运算实现
- **`src/addf.cpp`**: 实现单精度浮点数加法功能，处理浮点数运算和精度问题
- **`src/unified_api.cpp`**: 实现统一 API 的模板特化，连接统一接口和底层实现
- **`tests/test_addi.cpp`**: 整数加法功能的完整单元测试，包括正常值、边界值和特殊情况测试
- **`tests/test_addf.cpp`**: 浮点数加法功能的完整单元测试，包括精度测试和特殊值处理

### 核心概念

#### 模板特化 概念与模板结构
- **概念**: 模板特化是 C++ 的重要特性，允许为特定类型提供定制化的模板实现。在本项目中，`unified_add` 模板函数通过特化为 `int32_t` 和 `float` 类型，实现了统一的加法接口
- **模板结构**: 使用 `template<> T unified_add<T>(T a, T b)` 的特化语法，为每种支持的数值类型提供专门的实现，确保类型安全和性能优化

#### 静态库架构 概念与模板结构
- **概念**: 静态库架构将编译后的目标文件打包为 `.a` 文件，在链接时静态集成到目标程序中，无需运行时依赖
- **模板结构**: 通过 CMake 的 `add_library(func-add STATIC ${LIB_SOURCES})` 命令创建静态库，包含所有核心算法实现，提供头文件接口供外部调用

## 开发指南 (Development Guide)

### 流程标准化
项目开发遵循标准化流程：1) 需求分析和接口设计；2) 底层算法实现；3) API 层封装；4) 单元测试编写；5) 集成测试验证；6) 文档更新；7) 代码审查和合并。每个阶段都有明确的输入、动作和产出要求，确保开发质量和进度控制。

### 任务组织与命名规范
- **组织**: 任务按功能模块组织，算法实现、API 封装、测试用例分别存放在 src/、include/、tests/ 目录下，配置文件和文档分别存放在根目录和 docs/ 目录
- **命名**: 函数名采用小写加下划线命名法（如 `addi`、`addf`），类型名采用驼峰命名法（如 `UnifiedAdd`），文件名与主要功能或类名保持一致

### 能力与指令定义
- 能力定义基于功能模块，每个核心功能（如整数加法、浮点数加法）都有明确的输入输出规范和性能要求
- 指令定义遵循 C++ 标准语法，使用明确的类型声明和参数验证，确保接口的安全性和易用性
- 所有公共接口都有完整的文档注释，包括功能描述、参数说明、返回值说明和使用示例

## 运行与部署 (Running & Deployment)

### 快速开始
1. **克隆仓库**: `git clone [仓库地址] && cd examples/add-op`
2. **构建项目**: `mkdir build && cd build && cmake .. && make`
3. **运行测试**: `ctest` 验证所有功能正常工作
4. **集成使用**: 将 `libfunc-add.a` 和 `include/` 目录中的头文件集成到目标项目中

### 环境要求
- **CMake 版本**: 需要 CMake 3.10 或更高版本，用于构建系统生成和管理
- **C++ 编译器**: 需要 C++11 兼容的编译器，如 GCC 4.8+、Clang 3.3+ 或 MSVC 2015+
- **操作系统**: 支持 Linux、macOS 和 Windows 操作系统，具有良好的跨平台兼容性
- **内存要求**: 最小内存要求 512MB，推荐 1GB 以上，用于编译和测试过程

### 配置说明
项目配置主要通过 CMakeLists.txt 文件管理，包括编译选项（CMAKE_CXX_STANDARD、CMAKE_CXX_FLAGS）、包含目录（include_directories）、源文件列表（LIB_SOURCES）和测试配置。可以通过 CMake 命令行参数或 CMake GUI 进行自定义配置，如安装路径、构建类型等。

### 部署步骤
1. **编译生成**: 执行构建流程生成 `libfunc-add.a` 静态库文件
2. **头文件准备**: 将 `include/` 目录中的所有头文件复制到目标项目的包含路径
3. **库文件集成**: 将 `libfunc-add.a` 文件复制到目标项目的库文件路径或指定位置
4. **链接配置**: 在目标项目的构建配置中添加对 `func-add` 库的链接，并设置正确的包含路径
5. **验证测试**: 在目标项目中编译并运行测试程序，验证集成是否成功

## 代码规范 (Code Standards)

### C++头文件格式规范
- 头文件必须使用 `#ifndef` 宏定义保护，防止重复包含
- 头文件命名与主要功能或类名保持一致，使用 `.h` 扩展名
- 所有公共接口必须有完整的文档注释，包括功能描述、参数说明和返回值说明
- 头文件应该只包含必要的声明，避免包含实现细节

### C++源文件组织规范
- 源文件使用 `.cpp` 扩展名，与对应的头文件命名保持一致
- 源文件应该包含对应的头文件作为第一个包含项
- 实现代码应该按照功能逻辑组织，相关函数应该放在一起
- 每个函数都应该有适当的注释说明其功能和实现要点

### 命名约定
- **函数名**: 使用小写加下划线命名法，如 `addi`、`addf`、`unified_add`
- **类型名**: 使用驼峰命名法，如 `UnifiedApi`、`MathOperation`
- **常量名**: 使用全大写加下划线，如 `INT32_MAX`、`FLT_EPSILON`
- **文件名**: 与主要功能或类名保持一致，使用小写加下划线，如 `test_addi.cpp`

### 代码质量要求
- 所有代码必须通过编译器的警告检查（-Wall -Wextra）
- 核心功能必须有对应的单元测试覆盖，包括正常情况、边界情况和异常情况
- 代码复杂度应该控制在合理范围内，避免过深的嵌套和过长的函数
- 代码必须有适当的注释，特别是复杂的算法逻辑和重要的设计决策

## 安全考虑 (Security Considerations)

### 输入验证和清理
- 所有公共函数应该对输入参数进行类型检查，确保参数类型符合预期
- 对于数值运算，应该考虑溢出情况，虽然当前版本暂不处理 INT32_MAX + 1 等边界情况，但应该在文档中明确说明
- 浮点数运算应该考虑 NaN、Infinity 等特殊值的处理，确保程序稳定性
- 模板函数使用 `static_assert` 在编译时进行类型检查，防止不支持的类型调用

### 文件系统访问安全
- 项目只读取必要的头文件和源文件，不涉及用户文件系统访问
- 构建过程中生成的文件应该限制在 build 目录内，避免影响系统其他部分
- 安装过程应该遵循系统文件权限规范，避免权限提升问题
- 头文件和库文件的路径应该使用相对路径或标准系统路径，避免路径遍历攻击

### 命令执行安全
- 构建系统（CMake）应该使用可信的源，避免从不可信来源下载依赖
- 测试执行过程中不应该执行系统命令，所有测试都应该在受控环境中运行
- 编译选项应该使用安全的默认设置，避免不必要的安全风险
- 构建脚本应该有适当的权限控制，防止未授权修改

### 错误处理和日志记录
- 数值运算中的错误情况（如溢出）应该通过返回值或异常机制适当处理
- 测试框架应该提供详细的错误信息，帮助定位问题
- 构建过程中的错误应该有清晰的日志输出，便于问题诊断
- 不应该在日志中记录敏感信息，如具体的数值计算结果或内部状态

## 项目状态 (Project Status)

### 当前阶段
项目当前处于稳定维护阶段，核心功能已经完成并通过测试。当前版本为 0.1.1，已经完成了从 Make 到 CMake 的构建系统迁移，提升了跨平台兼容性。项目具备完整的文档、测试和构建流程，可以投入实际使用。

### 最新更新
- **构建系统迁移**: 2025-08-02 完成从 Make 到 CMake 的构建系统迁移，提升了跨平台兼容性
- **文档更新**: 2025-08-02 更新构建说明文档，适配新的 CMake 构建流程
- **初始版本发布**: 2025-07-27 发布 0.1.0 初始版本，完成基础架构和核心功能实现
- **测试完善**: 2025-07-27 完成所有核心功能的单元测试，确保代码质量和功能正确性

### 已知问题
- **整数溢出处理**: 当前版本暂不处理 INT32_MAX + 1 等整数溢出情况，这属于未定义行为，需要在后续版本中完善
- **浮点精度限制**: 浮点数运算存在精度限制，对于要求极高精度的应用场景可能不适用
- **类型支持有限**: 当前版本仅支持 int32_t 和 float 类型，对其他数值类型的支持需要在后续版本中扩展
- **性能优化**: 当前实现主要关注正确性，性能优化空间仍然存在

### 未来计划
- **扩展数据类型支持**: 计划在 0.2.0 版本中支持 double、int64_t 等更多数据类型
- **性能优化**: 0.2.0 版本将针对特定平台进行性能优化，提升运算效率
- **溢出处理机制**: 0.3.0 版本将实现完整的溢出检测和处理机制，增强安全性
- **更多数学运算**: 长期计划扩展支持减法、乘法、除法等更多基础数学运算

### 健康状况
项目整体健康状况良好。核心功能稳定，测试覆盖完整，文档齐全。构建系统现代化，支持跨平台部署。代码质量高，遵循良好的编码规范。项目具备良好的可维护性和扩展性，为后续发展奠定了坚实基础。

### 重要说明
- **版本兼容性**: 项目遵循语义化版本控制，主版本号变更可能包含不兼容的 API 变更
- **依赖管理**: 项目最小化外部依赖，仅依赖标准 C++ 库和 CMake 构建系统
- **许可证**: 项目采用 MIT 许可证，允许自由使用和修改，但需要保留版权声明
- **最佳实践**: 建议在使用前充分测试，特别是在关键应用场景中；建议定期更新到最新版本以获得功能改进和安全修复
